<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Code - M3103 - CHIGNARD Julien</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atelier-forest-light.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="..">M3103 - CHIGNARD Julien</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="..">Introduction</a>
                            </li>
                            <li >
                                <a href="../fonctionnement/">Fonctionnement</a>
                            </li>
                            <li >
                                <a href="../resultats/">Résultats</a>
                            </li>
                            <li class="active">
                                <a href="./">Code</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../resultats/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="disabled">
                                <a rel="prev" >
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#code">Code</a></li>
            <li><a href="#telechargement">Téléchargement</a></li>
            <li><a href="#code_1">Code</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="code"><center>Code</center></h1>
<p><center>Ici vous pourrez voir et télécharger le code en entier.</center></p>
<p><br></p>
<h2 id="telechargement">Téléchargement</h2>
<p>Vous pourrez télécharger le fichier en cliquant <a href="../hachageJV.cpp">Ici</a></p>
<p><br></p>
<h2 id="code_1">Code</h2>
<pre><code>#include &lt;unordered_map&gt;
#include &lt;iostream&gt;
#include &lt;fstream&gt;
#include &lt;cstring&gt;
#include &lt;chrono&gt;
#include &lt;getopt.h&gt;
#include &lt;vector&gt;
#include &lt;stdlib.h&gt;
#include &lt;math.h&gt;
#include &lt;stdio.h&gt;

int main(int argc, char * argv[]){

    uint maxfind = 1000;
    uint maxinsert = 1000;
    uint maxfindall = 300;
    uint maxinsertall = 300;
    int options;
    bool mode = 0;
    bool datamode = 0;
    int pas = 1;
    int mininsert = 10;
    int minfind = 10;
    uint iterations = 10;
    std::vector&lt;std::string&gt; livre;
    std::string writefic = "occurences.txt";
    std::string motcherche = "";
    std::string ficdatainsert = "datainsert.dat";
    std::string ficdatafind = "datafind.dat";
    std::string ficdataload = "dataload.dat";
    std::string ficdatall = "data.dat";

    while((options = getopt(argc, argv, "i:a:z:f:cm:dp:")) != -1){
        switch(options){
            case 'i':
                iterations = std::stoi(optarg);
                break;
            case 'a':
                mininsert = std::stoi(optarg);
                break;
            case 'z':
                maxinsertall = std::stoi(optarg);
                break;
            case 'f':
                writefic = optarg;
                break;
            case 'c':
                mode = true;
                break;
            case 'm':
                motcherche = optarg;
                break;
            case 'd':
                datamode = true;
                break;
            case 'p':
                pas = std::stoi(optarg);
                break;



        }
    }
minfind = mininsert;
maxfindall = maxinsertall;

    std::ifstream ifs;
    std::ofstream ofs;
    std::ofstream ficinsert, ficfind, ficload, ficall;

    std::cout &lt;&lt; "Réinitialisation du fichier d'occurences..." &lt;&lt; std::endl;
    if( remove(writefic.c_str()) != 0 )
    perror( "Echec de l'opération :/ " );
  else
    puts( "Fichier réinitialisé avec succès !" );

    ofs.open(writefic, std::ofstream::out);

    if(datamode){
        std::cout &lt;&lt; "Réinitialisation du fichier de temps d'insertion..." &lt;&lt; std::endl;
        if( remove(ficdatainsert.c_str()) != 0 )
        perror( "Echec de l'opération :/ " );
      else
        puts( "Fichier réinitialisé avec succès !" );

        std::cout &lt;&lt; "Réinitialisation du fichier de temps de recherche..." &lt;&lt; std::endl;
        if( remove(ficdatafind.c_str()) != 0 )
        perror( "Echec de l'opération :/ " );
        else
        puts( "Fichier réinitialisé avec succès !" );

        std::cout &lt;&lt; "Réinitialisation du fichier de taux de charge..." &lt;&lt; std::endl;
        if( remove(ficdataload.c_str()) != 0 )
            perror( "Echec de l'opération :/ " );
        else
            puts( "Fichier réinitialisé avec succès !" );

        std::cout &lt;&lt; "Réinitialisation du fichier global de données..." &lt;&lt; std::endl;
        if( remove(ficdatall.c_str()) != 0 )
            perror( "Echec de l'opération :/ " );
        else
            puts( "Fichier réinitialisé avec succès !" );

        ficinsert.open(ficdatainsert, std::ofstream::out);
        ficfind.open(ficdatafind, std::ofstream::out);
        ficload.open(ficdataload, std::ofstream::out);
        ficall.open(ficdatall, std::ofstream::out);

        ficall &lt;&lt; "#Données de temps d'insertion, de recherche et de taux de charge sur une table de hachage."&lt;&lt; std::endl;
        ficall &lt;&lt; "#Taille_map  Insertion   Recherche   Charge" &lt;&lt; std::endl;
    }


    ifs.open("Jules_Verne_Voyage_au_centre_de_la_Terre.txt", std::ifstream::in);

    if(!ifs.is_open()){return 1;}

    uint nbfind = 0;
    uint nbinsert = 0;

    std::chrono::nanoseconds time_find;
    std::chrono::nanoseconds time_insert;

    std::string mot;
    std::unordered_map&lt;std::string, int&gt; map;

    if(!mode){

    while(ifs &gt;&gt; mot &amp;&amp; ifs.good()){
        //ifs &gt;&gt; mot;
        livre.push_back(mot);
        std::unordered_map&lt;std::string, int&gt;::const_iterator found;

        std::chrono::steady_clock::time_point debfind = std::chrono::steady_clock::now();
        found = map.find(mot);
        std::chrono::steady_clock::time_point endfind = std::chrono::steady_clock::now();

        if(nbfind &lt;= maxfind){
        time_find = time_find + std::chrono::duration_cast&lt;std::chrono::nanoseconds&gt;(endfind - debfind);
        nbfind++;
    }

        if(found == map.end()){
            std::chrono::steady_clock::time_point debinsert = std::chrono::steady_clock::now();
            map[mot] = 1;
            std::chrono::steady_clock::time_point endinsert = std::chrono::steady_clock::now();

            if(nbinsert &lt;= maxinsert){
                time_insert = time_insert + std::chrono::duration_cast&lt;std::chrono::nanoseconds&gt;(endinsert - debinsert);
                nbinsert++;
            }
    }
        else
        map[mot]++;
    }

    for (auto&amp; x: map)
    ofs &lt;&lt; x.first &lt;&lt; ": " &lt;&lt; x.second &lt;&lt; std::endl;
if(motcherche != ""){
        std::unordered_map&lt;std::string, int&gt;::const_iterator motch = map.find(motcherche);
        std::cout&lt;&lt;"Nombre de mots différents : "&lt;&lt;map.size()&lt;&lt;std::endl;
        if(motch != map.end())
        std::cout &lt;&lt; "Nombre d'occurences du mot '"&lt;&lt;motcherche&lt;&lt;"' : "&lt;&lt;map[mot]&lt;&lt;std::endl;
        else
        std::cout &lt;&lt; "Le mot : '" &lt;&lt; motcherche &lt;&lt;"' ne figure pas dans le fichier." &lt;&lt; std::endl;
    }

    }
    else{
        while(ifs &gt;&gt; mot &amp;&amp; ifs.good())
        livre.push_back(mot);

std::vector&lt;std::chrono::nanoseconds&gt; tabtempsinsert;
std::vector&lt;std::chrono::nanoseconds&gt; tabtempsfind;

std::cout &lt;&lt; "Insertion..." &lt;&lt; std::endl;


        for(uint w=mininsert;w&lt;=maxinsertall;w=w+pas){

            while(map.size()&lt;w &amp;&amp; map.size()&lt;livre.size()){
                int chosen = std::rand() % livre.size();
                mot = livre[chosen];
                map[mot]++;
            }

                tabtempsfind.clear();
                tabtempsinsert.clear();

                if(datamode){
                    maxinsert = w;
                }
                else{w = maxinsertall;}
                    time_insert = std::chrono::nanoseconds::zero();

        std::unordered_map&lt;std::string, int&gt;::const_iterator found;

        //do{ // On choisit un mot au hasard qui n'est pas dans la table

        //}while(map.find(mot) != map.end());

        tabtempsfind.clear();
        for(uint i=1;i&lt;=iterations;++i){

            int chosen = (std::rand() % livre.size());
            mot = livre[chosen];

            std::chrono::steady_clock::time_point debfind = std::chrono::steady_clock::now();
            found = map.find(mot);
            std::chrono::steady_clock::time_point endfind = std::chrono::steady_clock::now();
            std::chrono::nanoseconds time_find = std::chrono::duration_cast&lt;std::chrono::nanoseconds&gt;(endfind - debfind);

            tabtempsfind.push_back(time_find);
}
            time_find = std::chrono::nanoseconds::zero();
            for(auto&amp; n : tabtempsfind){
                //if(n.count()&lt;1500)
                time_find += n;
                /*else
                time_find += std::chrono::nanoseconds(1500);*/
                //std::cout&lt;&lt;" "&lt;&lt;n.count();
            }

                //std::cout&lt;&lt;std::endl &lt;&lt; "temps find : "&lt;&lt;time_find.count()&lt;&lt;"size : "&lt;&lt;tabtempsfind.size()&lt;&lt;std::endl;

            double totimefind = time_find.count() / (double)tabtempsfind.size();
                //std::cout &lt;&lt;"totimefind : "&lt;&lt;totimefind&lt;&lt;std::endl;

            tabtempsinsert.clear();
        for(uint i=1;i&lt;=iterations;++i){

            int chosen = (std::rand() % livre.size());
            mot = livre[chosen];

                std::unordered_map&lt;std::string, int&gt; newmap(map);
                std::chrono::steady_clock::time_point debinsert = std::chrono::steady_clock::now();
                    newmap[mot]++;
                std::chrono::steady_clock::time_point endinsert = std::chrono::steady_clock::now();
                std::chrono::nanoseconds time_insert = std::chrono::duration_cast&lt;std::chrono::nanoseconds&gt;(endinsert - debinsert);
                newmap.clear();
                tabtempsinsert.push_back(time_insert);
        }
                time_insert = std::chrono::nanoseconds::zero();
                for(auto&amp; n : tabtempsinsert)
                    time_insert += n;

                double totimeinsert = time_insert.count() / (double)tabtempsinsert.size();

            //tabtempsinsert.push_back(time_insert);

            float progress = (float)(w-mininsert)/(maxinsertall-mininsert);
            int pos = 60 * progress;

            std::cout &lt;&lt; "[";
            for (int k = 0; k &lt; 60; ++k) {
        if (k &lt; pos) std::cout &lt;&lt; "#";
        else if (k == pos) std::cout &lt;&lt; "&gt;";
        else std::cout &lt;&lt; " ";
    }
    std::cout &lt;&lt; "] " &lt;&lt; std::ceil(progress * 100.0) &lt;&lt; " % | "&lt;&lt;std::ceil((w-mininsert)/pas)&lt;&lt;"/"&lt;&lt;std::ceil((maxinsertall-mininsert)/pas)&lt;&lt;"\r";
    std::cout.flush();

        if(datamode){
        ficinsert &lt;&lt; map.size()-1 &lt;&lt; " " &lt;&lt; time_insert.count()/100000000 &lt;&lt;std::endl;
        ficfind &lt;&lt; map.size()-1 &lt;&lt; " " &lt;&lt; (double)time_find.count()/100000000 &lt;&lt; std::endl;
        ficload &lt;&lt; map.size()-1 &lt;&lt; " " &lt;&lt; map.load_factor() &lt;&lt; std::endl;
        ficall&lt;&lt;map.size()-1&lt;&lt;" "&lt;&lt;totimeinsert/100000000&lt;&lt;" "&lt;&lt;totimefind/100000000&lt;&lt;" "&lt;&lt;map.load_factor()&lt;&lt;std::endl;
        }

        }


    std::cout &lt;&lt;std::endl&lt;&lt; "Insertion terminée." &lt;&lt; std::endl;

    /*  std::cout &lt;&lt; "Recherche..." &lt;&lt; std::endl;
        //maxfindall = maxfind + minfind;



        for(uint i=0;i&lt;maxfind;++i){
            int chosen = std::rand() % livre.size();
            mot = livre[chosen];

            std::chrono::steady_clock::time_point debfind = std::chrono::steady_clock::now();
        map.find(mot);
        std::chrono::steady_clock::time_point endfind = std::chrono::steady_clock::now();
        time_find = time_find + std::chrono::duration_cast&lt;std::chrono::nanoseconds&gt;(endfind - debfind);

        float progress = (float)i/maxfind;
        //std::cout &lt;&lt; progress &lt;&lt; "i : " &lt;&lt; i &lt;&lt; "max : " &lt;&lt; maxinsert &lt;&lt;std::endl;
        int pos = 60 * progress;

        std::cout &lt;&lt; "[";

        for (int k = 0; k &lt; 60; ++k) {
            if (k &lt; pos) std::cout &lt;&lt; "#";
            else if (k == pos) std::cout &lt;&lt; "&gt;";
            else std::cout &lt;&lt; " ";
        }
        std::cout &lt;&lt; "] " &lt;&lt; std::ceil(progress * 100.0) &lt;&lt; " %\r";
        std::cout.flush();

        }
        std::cout &lt;&lt; "Recherche terminée." &lt;&lt; std::endl;
    }*/


    std::cout &lt;&lt; std::endl &lt;&lt; map.size() &lt;&lt; " mots différents" &lt;&lt; std::endl;
    std::cout &lt;&lt; "Temps d'insertion pour "&lt;&lt;maxinsert&lt;&lt;" mots : "&lt;&lt; time_insert.count() &lt;&lt; "ns ("&lt;&lt;(double)time_insert.count()/100000000&lt;&lt;"s)" &lt;&lt; std::endl;
    std::cout &lt;&lt; "Temps de recherche pour "&lt;&lt;maxfind&lt;&lt;" mots : " &lt;&lt; time_find.count() &lt;&lt; "ns ("&lt;&lt;(double)time_find.count()/100000000&lt;&lt;"s)" &lt;&lt; std::endl;

}
}
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="https://cdn.plot.ly/plotly-latest.min.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
